# dopo aver creato il cluster:

# lanciare nell'ordine:
    namespace
    serviceAccount
    volume
    deployment
    service

sudo kubectl -n devops-tools get pods #prende nome pod
sudo kubectl -n devops-tools logs < NOME POD TROVATO> #trova la password d'accesso inizale jenkins

sudo kubectl create token -n devops-tools jenkins-admin #crea il token dalla vm
sudo kubectl exec -it -n devops-tools <NOME PDO TROVATO> -- /bin/bash # entra nel pod di jenkins

Comandi dentro pod jenkins:

# installazione kubectl
sudo curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/arm64/kubectl"
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
sudo chmod +x kubectl
mkdir -p ~/.local/bin
sudo mv ./kubectl ~/.local/bin/kubectl

# Configura kubectl con il token e il server API del cluster Kubernetes
kubectl config set-credentials jenkins-admin --token=<TOKEN CREATO PRECEDENTEMENTE>

#OPTIONAL# kubectl config set-credentials jenkins-admin --token=$ (solo nel job)<kube_token> #Sse le si vuole fare in un job

kubectl config set-cluster clusterdeplo --server=https://172.18.0.3:6443 --insecure-skip-tls-verify=true #metterci l'ip del control-plane
kubectl config set-context clusterdeplo --cluster=clusterdeplo --user=jenkins-admin #Crea un contesto associando il cluster e l'utente
kubectl config use-context clusterdeplo #usa il nuovo contesto appena creato

#installazione docker (dentro pod jenkins)

https://docs.docker.com/engine/install/debian/ #segui le istruzioni

#nodo dove è jenkins: kind-worker

oppure i comandi fatti sono:
for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do sudo apt-get remove $pkg; done
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin




#Installare plugin docker:
#   - docker pupeline
#   - docker




# dal browser

per collegarsi con l'app:

sudo kubectl get nodes -o wide | grep control-plane | awk '{print $6}' #trova l'ip
sudo kubectl get svc clusterdeplo -o wide | awk '{if(NR>1) print $5}' | cut -d':' -f2 | cut -d'/' -f1 #trova la porta

per collegarsi a jenkins: http://172.18.0.2:32000/
installare i plugin suggeriti e poi anche questi: kubernetes, kubernetes CLI, kubernetes pipeline,
github integration, git, github branch source, pipeline github, github authentication (alcuni sono già installati, verificare)

# kube-test: creare un job con execute shell cosi, se funziona è tutto ok
kubectl get pods
kubectl get pods -A
kubectl cluster-info